#!/usr/bin/bash

# Check if a file was provided
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <filename.md>"
    exit 1
fi

INPUT_FILE="$1"

# Check if file exists
if [ ! -f "$INPUT_FILE" ]; then
    echo "Error: File '$INPUT_FILE' not found."
    exit 1
fi

# Create output filename (replace .md with .txt)
OUTPUT_FILE="${INPUT_FILE%.*}.txt"

echo "Converting $INPUT_FILE to $OUTPUT_FILE..."

# Use sed to strip formatting
# Note: We use -E for extended regex support (works on Linux and macOS)
sed -E '
  # Remove HTML tags
  s/<[^>]*>//g;

  # Remove images ![alt](url) - remove the whole thing
  s/!\[[^]]*\]\([^)]*\)//g;

  # Replace links [text](url) with just "text"
  # To keep the URL as "text (url)", change formatting below to \1 (\2)
  s/\[([^]]*)\]\([^)]*\)/\1/g;

  # Remove headers (Lines starting with #)
  s/^#{1,6}\s*//;

  # Remove bold/italic (**text**, __text__, *text*, _text_)
  s/(\*\*|__)(.*?)\1/\2/g;
  s/(\*|_)(.*?)\1/\2/g;

  # Remove code blocks (```)
  s/^```//g;

  # Remove inline code (`code`)
  s/`([^`]*)`/\1/g;

  # Remove blockquotes (> text)
  s/^>\s*//;

  # Remove unordered list bullets (*, -, +) at start of line
  s/^[\*\-\+]\s+//;

  # Remove horizontal rules (---, ***, ___)
  s/^(\*{3,}|-{3,}|_{3,})$//;

' "$INPUT_FILE" > "$OUTPUT_FILE"

echo "Conversion complete."
